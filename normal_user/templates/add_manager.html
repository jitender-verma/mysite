{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Add Manager</title>

  <!-- Custom fonts for this template-->
  <link href="{% static 'vendor/fontawesome-free/css/all.min.css' %}" rel="stylesheet" type="text/css">
  <link
    href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
    rel="stylesheet">

  <link
    href="https://fonts.googleapis.com/css?family=Oswald:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
    rel="stylesheet">
  <!-- Custom styles for this template-->
  <link href="{% static 'css/sb-admin-2.css' %}" rel="stylesheet">

</head>

<body id="page-top">

  <!-- Page Wrapper -->
  <div id="wrapper">

    <!-- Sidebar -->
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

      <!-- Sidebar - Brand -->
      <a class="sidebar-brand d-flex align-items-center justify-content-center" href="{% url 'admin_dashboard' %}">
        <div class="sidebar-brand-icon">
          <img src="{% static 'images/logo-large-2.jpg' %}" title="Team Connect" alt="Team Connect">
        </div>
        <!-- <div class="sidebar-brand-text">Team Connect<sup></sup></div> -->
      </a>

      <!-- Divider -->
      <hr class="sidebar-divider my-0">

      <!-- Nav Item - Dashboard -->
      <li class="nav-item ">
        <a class="nav-link" href="{% url 'admin_dashboard' %}">
          <i class="fas fa-fw fa-tachometer-alt"></i>
          <span>Dashboard</span></a>
      </li>

      <!-- Divider -->
      <hr class="sidebar-divider">

      <!-- Heading -->
      <!-- <div class="sidebar-heading">
        Interface
      </div> -->

      <!-- Nav Item - Pages Collapse Menu -->
      <li class="nav-item">
        <a class="nav-link collapsed"  href="{% url 'manager_list' %}">
          <i class="fas fa-list"></i>
          <span>Managers List</span>
        </a>
        <!-- <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">
          <div class="bg-white py-2 collapse-inner rounded">
            <h6 class="collapse-header">Custom Components:</h6>
            <a class="collapse-item" href="buttons.html">Buttons</a>
            <a class="collapse-item" href="cards.html">Cards</a>
          </div>
        </div> -->
      </li>

      <!-- Divider -->
      <hr class="sidebar-divider">

      <!-- Nav Item - Utilities Collapse Menu -->
      <li class="nav-item active">
        <a class="nav-link collapsed" href="{% url 'add_manager' %}">
          <i class="fas fa-user-plus"></i>
          <span>Add Manager</span>
        </a>
      </li>
      <!-- Divider -->
      <hr class="sidebar-divider d-none d-md-block">

      <!-- Sidebar Toggler (Sidebar) -->
      <div class="text-center d-none d-md-inline">
        <button class="rounded-circle border-0" id="sidebarToggle"></button>
      </div>

    </ul>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">

        <!-- Topbar -->
        <nav class="navbar navbar-expand navbar-light bg-white topbar static-top shadow">

          <!-- Sidebar Toggle (Topbar) -->
          <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
            <i class="fa fa-bars"></i>
          </button>

          <!-- Topbar Navbar -->
          <ul class="navbar-nav ml-auto">


            <div class="topbar-divider d-none d-sm-block"></div>

            <!-- Nav Item - User Information -->
            <li class="nav-item dropdown no-arrow">
              <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false" title="Master Admin">
                <span class="mr-2 d-none d-lg-inline font-weight-bold text-black1 small">Master Admin</span>
                <!-- <img class="img-profile rounded-circle" src="{% static 'img/admin-demo.png' %}"> -->
              </a>
              <!-- Dropdown - User Information -->
              <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in" aria-labelledby="userDropdown">
                <!-- <a class="dropdown-item" href="#">
                  <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                  Profile
                </a> -->
               
                <div class="dropdown-divider"></div>
                <a class="dropdown-item"  data-toggle="modal" data-target="#logout-conformation-popup">
                  <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                  Logout
                </a>
              </div>
            </li>

          </ul>

        </nav>
        <!-- End of Topbar -->

        <div class="outer-dashboard py-md-4 py-lg-4 py-3">
          <!-- Begin Page Content -->
          <div class="container-fluid">
            <div class="page-wrap page-add-employee">
              <div class="row">
  
                <!-- Area Chart -->
                <div class="col-xl-12 col-lg-12">
  
                  <!-- Page Heading -->
                  <div class="d-sm-flex align-items-center justify-content-between mb-2">
                    <h1 class="h3 mb-0 text-gray-800">Add Manager</h1>
                  </div>
                  <div class="card shadow py-3 px-4">
                    <div class=" form-wrap-section">
                      <div class="form-wrap">
                        <div class="row form-row">
                          <div class="col-lg-6">
                            <div class="form-group">
                              <label>Name <span class="color-red">*</span></label>
                              <input type="text" class="form-control" placeholder="Enter Name" id="emergency_contact_person" onkeyup="full_name_validation()">
                              <label id="emergency_contact_person_error" style="display: none;color: red;"></label>
                            </div>
                          </div>
                        </div>
                        <div class="row form-row">
                          <div class="col-lg-6">
                            <div class="form-group">
                              <label>Email <span class="color-red">*</span></label>
                              <input type="email" class="form-control" placeholder="example@mail.com" id="email" onkeyup="email_validation()">
                              <label id="error_email" style="display: none;color: red;"></label>
                            </div>
                          </div>
                        </div>
                        <div class="row form-row">
                          <div class="col-lg-6">
                            <div class="form-group">
                              <label>Phone no. <span class="color-red">*</span></label>
                              <input type="text" class="form-control" placeholder="1234567890" id="contact_number" onkeyup="phone_number_validation()" onkeypress="return accept_number(event)">
                              <label id="contact_number_label" style="display: none;color: red;"></label>
                            </div>
                          </div>
                        </div>
                        <div class="row form-row">
                          <div class="col-lg-6">
                            <div class="form-group">
                              <label>Manager's timezone <span class="color-red">*</span></label>
                              <select class="form-control" id="manager_timezone" onchange="manager_timezone_validation()">
                                <option>Please select Manager's timezone</option>
                                {% for tim in timezones %}
                                  <option>{{tim}}</option>
                                {% endfor %}  
                              </select>
                              <label id="manager_timezone_error" style="display: none;color: red;"></label>
                            </div>
                          </div>

                          <div class="col-lg-3">
                            <div class="form-group">
                              <label>Time Zone 1 <span class="color-red">*</span></label>
                              <select class="form-control" id="timezone1" onchange="timezone1_validation()">
                                <option>Please select Time Zone 1</option>
                                {% for tim in timezones %}
                                  <option>{{tim}}</option>
                                {% endfor %}  
                              </select>
                              <label id="timezone_1_error" style="display: none;color: red;"></label>
                            </div>
                          </div>
                          <div class="col-lg-3">
                            <div class="form-group">
                              <label>Time Zone 2 <span class="color-red">*</span></label>
                              <select class="form-control" id="timezone2" onchange="timezone2_validation()">
                                <option>Please select Time Zone 2</option>
                                {% for tim in timezones %}
                                  <option>{{tim}}</option>
                                {% endfor %}  
                              </select>
                              <label id="timezone_2_error" style="display: none;color: red;"></label>
                            </div>
                          </div>
                          <div class="col-lg-3">
                            <div class="form-group">
                              <label>Time Zone 3 <span class="color-red">*</span></label>
                              <select class="form-control"  id="timezone3" onchange="timezone3_validation()">
                                <option>Please select Time Zone 3</option>
                                {% for tim in timezones %}
                                  <option>{{tim}}</option>
                                {% endfor %}  
                              </select>
                              <label id="timezone_3_error" style="display: none;color: red;"></label>
                            </div>
                          </div>
                          <div class="col-lg-3">
                            <div class="form-group">
                              <label>Time Zone 4 <span class="color-red">*</span></label>
                              <select class="form-control" id="timezone4" onchange="timezone4_validation()">
                                <option>Please select Time Zone 4</option>
                                {% for tim in timezones %}
                                  <option>{{tim}}</option>
                                {% endfor %}  
                              </select>
                              <label id="timezone_4_error" style="display: none;color: red;"></label>
                            </div>
                          </div>
                        </div>
                        <div class="row form-row">
                          <div class="col-lg-3">
                            <div class="form-group">
                              <label>Department <span class="color-red">*</span></label>
                              <select class="form-control" id="department" onchange="department_validation()">
                                <option>Please select department</option>
                                {% for dept in departments %}
                                  <option value="{{dept.id}}">{{dept.departments}}</option>
                                {% endfor %}
                              </select>
                              <label id="department_error" style="display: none;color: red;"></label>
                            </div>
                          </div>

                          <div class="col-lg-3">
                            <div class="form-group">
                              <label> Designation <span class="color-red">*</span></label>
                              <select class="form-control" id="designation" onchange="designation_validation()">
                                <option>Please select designation</option>
                                {% for fun in designations %}
                                  <option>{{fun.designation}}</option>
                                {% endfor %}  
                              </select>
                              <label id="designation_error" style="display: none;color: red;"></label>
                            </div>
                          </div>


                          <div class="col-lg-6">
                            <div class="form-group">
                              <label>Password <span class="color-red">*</span></label>
                              <input type="password" class="form-control" placeholder="Enter Password" id="password" onkeyup="password_validation()">
                              <label id="password_label" style="display: none;color: red;"></label>
                            </div>
                          </div>
  
  
  
                          <div class="col-lg-12">
                            <div class="form-group">
                              <button type="button" class="d-sm-inline-block btn btn-sm btn-primary sbt-btn shadow-sm" id="add_manager_btn"> Submit </button>
                            </div>
                          </div>
  
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- Content Row -->
  
                </div>
  
  
              </div>
            </div>
            <!-- Content Row -->
  
  
  
          </div>
          <!-- /.container-fluid -->
        </div>

      </div>
      <!-- End of Main Content -->


      <!-- End of Footer -->

    </div>
    <!-- End of Content Wrapper -->

  </div>
  <!-- End of Page Wrapper -->

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>



  <div class="adjust-clock task add-dce manager-alert modal" id="logout-conformation-popup" tabindex="-1" role="dialog"
  aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header py-2 flex-row align-items-center justify-content-between">
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <div class="close-btn mt-0">
            <span aria-hidden="true">×</span>
          </div>
        </button>
      </div>
      <div class="modal-body p-3 p-md-4 p-lg-4">
        <div class="row form-row">
          <div class="col-lg-12 text-center">
            <p class="m-0" id="universal_ssmsg">Are you sure you want to logout?</p>
          </div>
        </div>
      </div>
      <div class="modal-footer border-top-0">
        <a class="d-sm-inline-block btn btn-sm btn-primary yes-btn sbt-btn shadow-sm mr-2" href="{% url 'logout' %}"> Yes </a>
        <button class="d-sm-inline-block btn btn-sm btn-primary yes-btn sbt-btn brown-clr shadow-sm" type="button"
          data-dismiss="modal"> No </button>
      </div>
    </div>
  </div>
</div>



 <div class="submit-msg alert modal fade" id="universal_msg_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header py-2 flex-row align-items-center justify-content-between">
        <button class="close close-bntn" type="button" data-dismiss="modal" aria-label="Close">
          <div class="close-btn mt-0">
            <span aria-hidden="true">×</span>
          </div>
        </button>
      </div>
      <div class="modal-body">
        <div class="row form-row">
          <div class="col-lg-12 text-center">
              <p class="m-0" id="universal_msg">Manager added successfully</p>
          </div>          
        </div>
      </div>
      <div class="modal-footer border-top-0">
        <button class="d-sm-inline-block btn btn-sm btn-primary sbt-btn close-bntn shadow-sm" type="button"  data-dismiss="modal"> Ok </button>
      </div>
    </div>
  </div>
</div>


 <div class="submit-msg alert modal fade" id="universal_msg_modal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header py-2 flex-row align-items-center justify-content-between">
        <button class="close " type="button" data-dismiss="modal" aria-label="Close">
          <div class="close-btn mt-0">
            <span aria-hidden="true">×</span>
          </div>
        </button>
      </div>
      <div class="modal-body">
        <div class="row form-row">
          <div class="col-lg-12 text-center">
              <p class="m-0" id="universal_msg1">Employee added successfully</p>
          </div>          
        </div>
      </div>
      <div class="modal-footer border-top-0">
        <button class="d-sm-inline-block btn btn-sm btn-primary sbt-btn  shadow-sm" type="button"  data-dismiss="modal"> Ok </button>
      </div>
    </div>
  </div>
</div>


  <!-- Bootstrap core JavaScript-->
  <script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
  <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
  <!-- Core plugin JavaScript-->
  <script src="{% static 'vendor/jquery-easing/jquery.easing.min.js' %}"></script>
  <!-- Custom scripts for all pages-->
  <script src="{% static 'js/sb-admin-2.js' %}"></script>
  <script type="text/javascript">


     function accept_number(evt){
          evt = (evt) ? evt : window.event;
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                return false;
            }
            return true;
        }




    function phone_number_validation(){
        phone_number = $("#contact_number").val()

        if (phone_number == ""){
            $("#contact_number_label").show()
            $("#contact_number_label").html("This field is required")
            return false
        }
        else if (phone_number.length < 4 || phone_number.length >20){
            $("#contact_number_label").show()
            $("#contact_number_label").html("A phone number must contain 4-20 digits")
            return false;
        }
        else{
            $("#contact_number_label").hide()
            return true;               
        }
    }

    function email_validation(){
        email = $('#email').val()
        email = $.trim(email)
        var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;

        if(email.length == '' || email.length == null) {
            $("#error_email").show()
            $("#error_email").html("This field is required");
            return false;
        }            
        else if(regex.test(email)==false){
            $("#error_email").show()
            $("#error_email").html("Please enter a valid email address")
            return false;
        }
        else{
            $("#error_email").hide()
            return true;
        }
    }


    function password_validation(){
        password=$("#password").val();
        if(password.length == '' || password.length == null) {
            $("#password_label").show()
            $("#password_label").html("This field is required");
            return false;
        }
        else{
            if(password.length < 6 || password.length > 20 ){
                $("#password_label").show()
                $("#password_label").html("Password must contain 6 to 20 characters");
                return false;
            }
            else if(!!~password.indexOf(' ')){
                $("#password_label").show()
                $("#password_label").html("Password must not contain white spaces");
                return false;
            }
            else{
                $("#password_label").hide()
                return true;
            }
        }
    };

    function full_name_validation(){
      var full_name_regex = /^[a-zA-Z ]+$/;
      full_name = $('#emergency_contact_person').val()
      full_name = $.trim(full_name)
      if(full_name == '' || full_name == null) {
          $("#emergency_contact_person_error").show()
          $("#emergency_contact_person_error").html("This field is required");               
          return false;
      }
      else if(full_name_regex.test(full_name) == false){
          $("#emergency_contact_person_error").show()
          $("#emergency_contact_person_error").html("Name must not contain numbers or any special characters");
          return false;                
      }

      else if (full_name.length < 3){
          $("#emergency_contact_person_error").show()
          $("#emergency_contact_person_error").html("Name must contain more than 3 characters");
          return false;
      }
      else if(full_name.length > 50){
          $("#emergency_contact_person_error").show()
          $("#emergency_contact_person_error").html("Name must contain less than 50 characters");
          return false; 
      }
      else{
          $("#emergency_contact_person_error").hide()
          return true;
      }
    }

    function department_validation(){
      dept = $("#department option:selected").text()
      if(dept == "Please select department"){
        $("#department_error").html("Please select department")
        $("#department_error").show()
        return false
      }
      else{
        $("#department_error").hide()
        return true
      }
    }

    function designation_validation(){
      designation = $("#designation option:selected").text()
      if(designation == "Please select designation"){
        $("#designation_error").html("Please select designation")
        $("#designation_error").show()
        return false
      }
      else{
        $("#designation_error").hide()
        return true
      }
    }

    function timezone1_validation(){
      city = $("#timezone1 option:selected").text()
      if(city == "Please select Time Zone 1"){
        $("#timezone_1_error").html("Please select Time Zone 1")
        $("#timezone_1_error").show()
        return false
      }
      else{
        $("#timezone_1_error").hide()
        return true
      }
    }


     function timezone2_validation(){
        city = $("#timezone2 option:selected").text()
        if(city == "Please select Time Zone 2"){
          $("#timezone_2_error").html("Please select Time Zone 2")
          $("#timezone_2_error").show()
          return false
        }
        else{
          $("#timezone_2_error").hide()
          return true
        }
    }

     function timezone3_validation(){
        city = $("#timezone3 option:selected").text()
        if(city == "Please select Time Zone 3"){
          $("#timezone_3_error").html("Please select Time Zone 3")
          $("#timezone_3_error").show()
          return false
        }
        else{
          $("#timezone_3_error").hide()
          return true
        }
    }

     function timezone4_validation(){
        city = $("#timezone4 option:selected").text()
        if(city == "Please select Time Zone 4"){
          $("#timezone_4_error").html("Please select Time Zone 4")
          $("#timezone_4_error").show()
          return false
        }
        else{
          $("#timezone_4_error").hide()
          return true
        }
    }

    function manager_timezone_validation(){
      city = $("#manager_timezone option:selected").text()
        if(city == "Please select Manager's timezone"){
          $("#manager_timezone_error").html("Please select Manager's timezone")
          $("#manager_timezone_error").show()
          return false
        }
        else{
          $("#manager_timezone_error").hide()
          return true
        }
    }

    $("#add_manager_btn").click(function(){
      phone_number_validation()
      email_validation()
      password_validation()
      full_name_validation()
      department_validation()
      designation_validation()
      manager_timezone_validation()
      timezone1_validation()
      timezone2_validation()
      timezone3_validation()
      timezone4_validation()
      if (phone_number_validation() && email_validation() && password_validation() && full_name_validation() && department_validation() && designation_validation() && timezone1_validation() && timezone2_validation() && timezone3_validation() && timezone4_validation() && manager_timezone_validation()){
        $.ajax({
            type: 'POST',
            url: "{% url 'add_manager' %}",
            data: {
                "emergency_contact_person" : $("#emergency_contact_person").val(),
                "email" : $("#email").val(),
                "contact_number" : $("#contact_number").val(),
                "timezone1" : $("#timezone1 option:selected").text(),
                "timezone2" : $("#timezone2 option:selected").text(),
                "timezone3" : $("#timezone3 option:selected").text(),
                "timezone4" : $("#timezone4 option:selected").text(),
                "department" : $("#department option:selected").text(),
                "department_id" : $("#department option:selected").val(),
                "designation" : $("#designation option:selected").text(),
                "manager_timezone" : $("#manager_timezone option:selected").text(),
                "password" : $("#password").val(),
            },
            success: function(response){
              if(response == "User Created"){
                $("#universal_msg_modal").modal("show")

              }
              else{
                $("#universal_msg1").html("Email already exist. Please try with different email.")
                    $("#universal_msg_modal1").modal("show")
              }
            }
        });
      }
    })

    $(".close-bntn").click(function(){
      location.href = "{% url 'admin_dashboard' %}";
    })


  </script>
</body>

</html>