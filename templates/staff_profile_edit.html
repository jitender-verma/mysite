{% extends 'base.html' %}
{% load static %}
{% block title %}Edit Employee Profile{% endblock %}
{% block content %}

                <div class="container-fluid">
                    <div class="page-wrap page-add-employee">
                        <!-- Content Row -->
                        <div class="row">
    
                            <!-- Area Chart -->
                            <div class="col-xl-12 col-lg-12">
                                <div class="all-center-profile-block">
                                    <!-- Page Heading -->
                                    <div class="d-sm-flex align-items-center justify-content-between mb-2">
                                        <h1 class="h3 mb-0 mt-2 text-gray-800">Team Connect</h1>
                                        <!-- <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i
                                                class="fas fa-download fa-sm text-white-50"></i> Generate Report</a> -->
                                    </div>
    
                                    <div class="card shadow mb-4">
                                        <!-- Card Header - Dropdown -->
                                        <div
                                            class="card-header px-3 py-3 d-block d-md-flex d-lg-flex flex-row align-items-center justify-content-between">
                                            <h6 class="m-0 mr-1 font-weight-bold text-primary">Staff Profile</h6>
                                            <div class="btn-wrapper mt-2 mt-md-0 mt-lg-0">
                                                <a class="mr-1 d-sm-inline-block btn common-btns btn-sm btn-primary" id="edit_profile_btn">Edit</a>
                                            </div>
                                        </div>
                                        <!-- Card Body -->
                                        <div class="card-body">
                                            <div class="employee-profile manager-profile d-xs-block">
                                                <div class="row">
                                                    <div class="img-wrapper rounded mb-2 mb-md-0 mb-lg-0 col-md-5">
                                                        <div class="img-hover">
                                                            <img src="{% static 'img/admin-demo.png' %}"
                                                                title="Staff Profile" alt="Staff Profile">
                                                        </div>
                                                        <!-- <div class="camera-block">
                                                            <label for="image" class="camera-img"><i class="fas fa-camera"></i> </label>
                                                            <input type="text" id="image" class="form-control camera-fix" placeholder="Enter Number" required="">
                                                        </div> -->
                                                    </div>
    
                                                    <div class="information-part col-md-7">
                                                        <div class="row form-row ">
                                                            <div class="col-lg-12">
                                                                <div class="form-group">
                                                                    <label>Name </label>
                                                                    <input type="text" class="form-control" placeholder="Enter Number" required="" value="{{user_details.name}}" onkeyup="full_name_validation()" id="staff_mem_name" readonly>
                                                                     <label id="emergency_contact_person_error" style="display: none;color: red;"></label>
                                                                </div>
                                                            </div>
    
                                                            
    
                                                            <div class="col-lg-12">
                                                                <div class="form-group">
                                                                    <label>Email 1</label>
                                                                    <input type="email" class="form-control"
                                                                        placeholder="Enter Number" value="{{user_details.user.username}}" required=""  id="staff_mem_email1" onkeyup="email1_validation()" readonly>
                                                                         <label id="error1_email" style="display: none;color: red;"></label>
                                                                </div>
                                                            </div>


                                                            <!-- <div class="col-lg-12">
                                                                <div class="form-group">
                                                                    <label>Department</label>
                                                                  
                                                                      <select class="form-control" id="department">
                                                                        <option>Please select department</option>
                                                                        {% for dept in departments %}
                                                                          <option value="{{dept.id}}" {% if dept.departments == user_details.department.departments %}selected{% endif %}>{{dept.departments}}</option>
                                                                        {% endfor %}
                                                                      </select>
                                                                      <label id="department_error" style="display: none;color: red;"></label>
                                                                    
                                                                </div>
                                                            </div> -->
    
                                                            <div class="col-lg-12">
                                                                <div class="form-group">
                                                                  <button type="button" class="d-sm-inline-block btn btn-sm btn-primary sbt-btn shadow-sm" id="update_btn" disabled> Update </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
    
                            
                        </div>
                        <!--/row  -->
                    </div>
                    <!-- /.container-fluid -->
                </div>

                <!-- End of Footer -->

            </div>
            <!-- End of Content Wrapper -->

        </div>
        <!-- End of Page Wrapper -->

        <!-- Scroll to Top Button-->
        <a class="scroll-to-top rounded" href="#page-top">
            <i class="fas fa-angle-up"></i>
        </a>


          <div class="submit-msg alert modal fade" id="universal_msg_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
              aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header py-2 flex-row align-items-center justify-content-between">
                    <button class="close close-bntn" type="button" data-dismiss="modal" aria-label="Close">
                      <div class="close-btn mt-0">
                        <span aria-hidden="true">×</span>
                      </div>
                    </button>
                  </div>
                  <div class="modal-body">
                    <div class="row form-row">
                      <div class="col-lg-12 text-center">
                          <p class="m-0" id="universal_msg"></p>
                      </div>          
                    </div>
                  </div>
                  <div class="modal-footer border-top-0">
                    <button class="d-sm-inline-block btn btn-sm btn-primary sbt-btn shadow-sm close-bntn" type="button"  data-dismiss="modal"> Ok </button>
                  </div>
                </div>
              </div>
            </div>


<div class="submit-msg alert modal fade" id="universal_msg_modal1111" tabindex="-1" role="dialog"
  aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header py-1 flex-row align-items-center justify-content-between">
        <button class="close " type="button" data-dismiss="modal" aria-label="Close">
          <div class="close-btn">
            <span aria-hidden="true">×</span>
          </div>
        </button>
      </div>
      <div class="modal-body">
        <div class="row form-row">
          <div class="col-lg-12 text-center">
            <p class="m-0" >Something Went Wrong</p>
          </div>
        </div>
      </div>
      <div class="modal-footer border-top-0">
        <button class="d-sm-inline-block btn btn-sm btn-primary sbt-btn shadow-sm " type="button"
          data-dismiss="modal"> Ok </button>
      </div>
    </div>
  </div>
</div>

             <div class="submit-msg alert modal fade" id="universal_msg_modal11" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
              aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header py-2 flex-row align-items-center justify-content-between">
                    <button class="close " type="button" data-dismiss="modal" aria-label="Close">
                      <div class="close-btn mt-0 ">
                        <span aria-hidden="true">×</span>
                      </div>
                    </button>
                  </div>
                  <div class="modal-body">
                    <div class="row form-row">
                      <div class="col-lg-12 text-center">
                          <p class="m-0" id="universal_msg11"></p>
                      </div>          
                    </div>
                  </div>
                  <div class="modal-footer border-top-0">
                    <button class="d-sm-inline-block btn btn-sm btn-primary sbt-btn shadow-sm " type="button"  data-dismiss="modal"> Ok </button>
                  </div>
                </div>
              </div>
            </div>

        <!-- Bootstrap core JavaScript-->
        <script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
        <script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
        <!-- Core plugin JavaScript-->
        <script src="{% static 'vendor/jquery-easing/jquery.easing.min.js' %}"></script>
        <!-- Custom scripts for all pages-->
        <script src="{% static 'js/sb-admin-2.js' %}"></script>
        <script type="text/javascript"> 
            function accept_number(evt){
              evt = (evt) ? evt : window.event;
                var charCode = (evt.which) ? evt.which : evt.keyCode;
                if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                    return false;
                }
                return true;
            }

            $('#countdown_timer option[value=10]').attr('selected','selected');

            function phone_number1_validation(){       

                phone_number = $("#staff_mem_phone1").val()
                 phone_number_1 = $("#staff_mem_phone2").val()
                if (phone_number == ""){
                    $("#contact_number1_label").show()
                    $("#contact_number1_label").html("This field is required")
                    return false
                }
                else if (phone_number.length < 4 || phone_number.length >20){
                    $("#contact_number1_label").show()
                    $("#contact_number1_label").html("A phone number must contain 4-20 digits")
                    return false;
                }
                else if (phone_number == phone_number_1){
                    $("#contact_number1_label").show()
                    $("#contact_number1_label").html("Phone numbers should not be same")
                    return false;
                }
                else{
                    $("#contact_number1_label").hide()
                    return true;               
                }
            }

            function phone_number2_validation(){

                phone_number_1 = $("#staff_mem_phone1").val()
                phone_number = $("#staff_mem_phone2").val()

                if (phone_number != ""){
                    // $("#contact_number2_label").show()
                    // $("#contact_number2_label").html("This field is required")
                    // return false
                    if (phone_number.length < 4 || phone_number.length >20){
                        $("#contact_number2_label").show()
                        $("#contact_number2_label").html("A phone number must contain 4-20 digits")
                        return false;
                    }
                    else if (phone_number == phone_number_1){
                        $("#contact_number2_label").show()
                        $("#contact_number2_label").html("Phone numbers should not be same")
                        return false;
                    }
                    else{
                        $("#contact_number2_label").hide()
                        return true;               
                    }
                }
                else{
                        $("#contact_number2_label").hide()
                        return true;               
                    }
                
            }

            function email1_validation(){
                email = $('#staff_mem_email1').val()
                email = $.trim(email)
                email1 = $('#staff_mem_email2').val()
                var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;

                if(email.length == '' || email.length == null) {
                    $("#error1_email").show()
                    $("#error1_email").html("This field is required");
                    return false;
                }            
                else if(regex.test(email)==false){
                    $("#error1_email").show()
                    $("#error1_email").html("Please enter a valid email address")
                    return false;
                }
                else if(email1 == email){
                    $("#error1_email").show()
                    $("#error1_email").html("Emails should not be same")
                    return false;
                }
                else{
                    $("#error1_email").hide()
                    return true;
                }
            }

            function emai2_validation(){
                email1 = $('#staff_mem_email1').val()
                email = $('#staff_mem_email2').val()
                email = $.trim(email)
                var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;

                if(email.length != '' ) {
                    // $("#error2_email").show()
                    // $("#error2_email").html("This field is required");
                    // return false;
                    if(regex.test(email)==false){
                        $("#error2_email").show()
                        $("#error2_email").html("Please enter a valid email address")
                        return false;
                    }
                    else if(email1 == email){
                        $("#error2_email").show()
                        $("#error2_email").html("Emails should not be same")
                        return false;
                    }
                    else{
                        $("#error2_email").hide()
                        return true;
                    }
                }            
                else {
                  $("#error2_email").hide()
                  return true;
                }
                
            }

            function full_name_validation(){
                var full_name_regex = /^[a-zA-Z ]+$/;
                full_name = $('#staff_mem_name').val()
                full_name = $.trim(full_name)
                if(full_name == '' || full_name == null) {
                    $("#emergency_contact_person_error").show()
                    $("#emergency_contact_person_error").html("This field is required");               
                    return false;
                }
                else if(full_name_regex.test(full_name) == false){
                    $("#emergency_contact_person_error").show()
                    $("#emergency_contact_person_error").html("Name must not contain numbers or any special characters");
                    return false;                
                }

                else if (full_name.length >50 || full_name.length <3){
                    $("#emergency_contact_person_error").show()
                    $("#emergency_contact_person_error").html("Name contains at least 3 characters");
                    return false;
                }
                else{
                    $("#emergency_contact_person_error").hide()
                    return true;
                }
            }

            function department_validation(){
              dept = $("#department option:selected").text()
              if(dept == "Please select department"){
                $("#department_error").html("Please select department")
                $("#department_error").show()
                return false
              }
              else{
                $("#department_error").hide()
                return true
              }
            }


             $("#edit_profile_btn").click(function(){
                $('#staff_mem_name').prop('readonly', false);
                $('#department').prop('disabled', false);
                $("#staff_mem_email1").prop('readonly', false);
                $("#staff_mem_email2").prop('readonly', false);
                $("#staff_mem_phone1").prop('readonly', false);
                $("#staff_mem_phone2").prop('readonly', false);
                
                var first_name = $('#staff_mem_name').val();
                first_name = first_name.trim()        
                $('#staff_mem_name').focus().val('').val(first_name);
                $("#update_btn").prop('disabled', false);

            })


            $("#update_btn").click(function(){
                // phone_number1_validation()
                // phone_number2_validation()
                email1_validation()
                // emai2_validation()
                full_name_validation()
                // department_validation()
                if (email1_validation()  && full_name_validation()){
                    $.ajax({
                        type: 'POST',
                        url: "{% url 'staff_profile_post' %}",
                        data: {
                            "user_id" : "{{employee_id}}",
                            "emergency_contact_person" : $("#staff_mem_name").val(),
                            "staff_mem_email1" : $("#staff_mem_email1").val(),
                            // "department" : $("#department option:selected").text(),
                            // "department_id" : $("#department option:selected").val(),
                        },
                        success: function(response){
                          if(response == 1){
                            $("#universal_msg").text("Saved changes successfully")
                            $("#universal_msg_modal").modal("show")
                          }
                          else if(response == 5){
                            $("#universal_msg11").text("Email already exist")
                            $("#universal_msg_modal11").modal("show")
                          }
                          else{
                           $("#universal_msg_modal1111")modal("show")
                          }
                        }
                    });
                }
             })
            $(".close-bntn").click(function(){
                location.href = "{% url 'manager_dashboard' %}";
            })
        </script>
{% endblock %}