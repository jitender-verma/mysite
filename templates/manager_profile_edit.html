{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Admin Dashboard</title>

  <!-- Custom fonts for this template-->
  <link href="{% static 'vendor/fontawesome-free/css/all.min.css' %}" rel="stylesheet" type="text/css">
  <link
    href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
    rel="stylesheet">

  <link
    href="https://fonts.googleapis.com/css?family=Oswald:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
    rel="stylesheet">
  <!-- Custom styles for this template-->
  <link href="{% static 'css/sb-admin-2.css' %}" rel="stylesheet">

</head>

<body id="page-top">

  <!-- Page Wrapper -->
  <div id="wrapper">

    <!-- Sidebar -->
    <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

      <!-- Sidebar - Brand -->
      <a class="sidebar-brand d-flex align-items-center justify-content-center" href="{% url 'admin_dashboard' %}">
        <div class="sidebar-brand-icon">
          <img src="{% static 'images/logo-large-2.jpg' %}" title="Team Connect" alt="Team Connect">
        </div>
        <!-- <div class="sidebar-brand-text">Team Connect<sup></sup></div> -->
      </a>

      <!-- Divider -->
      <hr class="sidebar-divider my-0">

      <!-- Nav Item - Dashboard -->
      <li class="nav-item active">
        <a class="nav-link" href="{% url 'admin_dashboard' %}">
          <i class="fas fa-fw fa-tachometer-alt"></i>
          <span>Dashboard</span></a>
      </li>

      <!-- Divider -->
      <hr class="sidebar-divider">

      <!-- Nav Item - Pages Collapse Menu -->
      <li class="nav-item">
        <a class="nav-link collapsed"  href="{% url 'manager_list' %}">
          <i class="fas fa-list"></i>
          <span>Managers List</span>
        </a>
      </li>

      <!-- Divider -->
      <hr class="sidebar-divider">

      <!-- Nav Item - Utilities Collapse Menu -->
      <li class="nav-item">
        <a class="nav-link collapsed" href="{% url 'add_manager' %}">
          <i class="fas fa-user-plus"></i>
          <span>Add Manager</span>
        </a>
      </li>


      <!-- Divider -->
      <hr class="sidebar-divider d-none d-md-block">

      <!-- Sidebar Toggler (Sidebar) -->
      <div class="text-center d-none d-md-inline">
        <button class="rounded-circle border-0" id="sidebarToggle"></button>
      </div>

    </ul>
    <!-- End of Sidebar -->

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

      <!-- Main Content -->
      <div id="content">

        <!-- Topbar -->
        <nav class="navbar navbar-expand navbar-light bg-white topbar static-top shadow">

          <!-- Sidebar Toggle (Topbar) -->
          <button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-3">
            <i class="fa fa-bars"></i>
          </button>


          <!-- Topbar Navbar -->
          <ul class="navbar-nav ml-auto">

            <div class="topbar-divider d-none d-sm-block"></div>

            <!-- Nav Item - User Information -->
            <li class="nav-item dropdown no-arrow">
              <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false" title="Master Admin">
                <span class="mr-2 d-none d-lg-inline font-weight-bold text-black1 small">Master Admin</span>
                <!-- <img class="img-profile rounded-circle" src="{% static 'img/admin-demo.png' %}"> -->
              </a>
              <!-- Dropdown - User Information -->
              <div class="dropdown-menu dropdown-menu-right shadow animated--grow-in" aria-labelledby="userDropdown">
                <!-- <a class="dropdown-item" href="#">
                  <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                  Profile
                </a> -->
                <!-- <div class="dropdown-divider"></div> -->
                <a class="dropdown-item" data-toggle="modal" data-target="#logout-conformation-popup">
                  <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
                  Logout
                </a>
              </div>
            </li>

          </ul>

        </nav>
        <!-- End of Topbar -->
            <div class="container-fluid">
                <div class="page-wrap page-add-employee">
                    <!-- Content Row -->
                    <div class="row">

                        <!-- Area Chart -->
                        <div class="col-xl-12 col-lg-12">
                            <div class="all-center-profile-block">
                                <!-- Page Heading -->
                                <div class="card shadow mb-4 mt-4">
                                    <!-- Card Header - Dropdown -->
                                    <div
                                        class="card-header px-3 py-3 d-block d-md-flex d-lg-flex flex-row align-items-center justify-content-between">
                                        <h6 class="m-0 mr-1 font-weight-bold text-primary">Manager Profile</h6>
                                        <div class="btn-wrapper mt-2 mt-md-0 mt-lg-0">
                                            <a class="mr-1 d-sm-inline-block btn common-btns btn-sm btn-primary" id="edit_profile_btn">Edit</a>
                                        </div>
                                    </div>
                                    <!-- Card Body -->
                                    <div class="card-body">
                                        <div class="employee-profile manager-profile d-xs-block">
                                            <div class="row">
                                                <div class="rounded mb-2 mb-md-0 mb-lg-0 col-md-5">
                                                    <div class="img-hover">
                                                        <img src="{% static 'img/admin-demo.png' %}"
                                                            title="Employee Profile" alt="Employee Profile">
                                                    </div>
                                                    <!-- <div class="camera-block">
                                                        <label for="image" class="camera-img"><i class="fas fa-camera"></i> </label>
                                                        <input type="text" id="image" class="form-control camera-fix" placeholder="Enter Number" required="">
                                                    </div> -->
                                                </div>

                                                <div class="information-part col-md-7">
                                                    <div class="row form-row ">
                                                        <div class="col-lg-12">
                                                            <div class="form-group">
                                                                <label>Name </label>
                                                                <input type="text" class="form-control" placeholder="Enter Name" required="" value="{{manager_details.full_name}}" id="emergency_contact_person" onkeyup="full_name_validation()" readonly>
                                                                 <label id="emergency_contact_person_error" style="display: none;color: red;"></label>
                                                            </div>
                                                        </div>

                                                        <!-- <div class="col-lg-12">
                                                            <div class="form-group">
                                                                <label>Designation </label>
                                                                <input type="text" class="form-control"
                                                                    placeholder="Enter Designation" required="">
                                                            </div>
                                                        </div> -->

                                                       

                                                        <div class="col-lg-12">
                                                            <div class="form-group">
                                                                <label>Email </label>
                                                                <input type="email" class="form-control"
                                                                    placeholder="Enter Email" value="{{manager_details.manaager.username}}" required=""  id="email" onkeyup="email_validation()" readonly>
                                                                     <label id="error_email" style="display: none;color: red;"></label>
                                                            </div>
                                                        </div>

                                                        <!-- <div class="col-lg-12">
                                                            <div class="form-group">
                                                                <label>Department</label>
                                                                <select class="form-control" id="department" onchange="department_validation()" disabled>
                                                                    <option>Please select department</option>
                                                                    {% for dept in departments %}
                                                                      <option value="{{dept.id}}" {% if dept.departments == manager_details.department.departments %}selected{% endif %}>{{dept.departments}}</option>
                                                                    {% endfor %}
                                                                  </select>
                                                                  <label id="department_error" style="display: none;color: red;"></label>
                                                                
                                                            </div>
                                                        </div> -->

                                                        <div class="col-lg-12">
                                                            <div class="form-group">
                                                              <button type="button" class="d-sm-inline-block btn btn-sm btn-primary sbt-btn shadow-sm" id="update_btn" disabled> Update </button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        
                    </div>
                    <!--/row  -->
                </div>
                <!-- /.container-fluid -->
            </div>
        </div>
    </div><!-- End of Content Wrapper -->
</div>
<!-- End of Page Wrapper -->

<!-- Scroll to Top Button-->
<a class="scroll-to-top rounded" href="#page-top">
    <i class="fas fa-angle-up"></i>
</a>


  <div class="submit-msg alert modal fade" id="universal_msg_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header py-2 flex-row align-items-center justify-content-between">
        <button class="close close-bntn" type="button" data-dismiss="modal" aria-label="Close">
          <div class="close-btn mt-0">
            <span aria-hidden="true">×</span>
          </div>
        </button>
      </div>
      <div class="modal-body">
        <div class="row form-row">
          <div class="col-lg-12 text-center">
              <p class="m-0" id="universal_msg"></p>
          </div>          
        </div>
      </div>
      <div class="modal-footer border-top-0">
        <button class="d-sm-inline-block btn btn-sm btn-primary sbt-btn shadow-sm close-bntn" type="button"  data-dismiss="modal"> Ok </button>
      </div>
    </div>
  </div>
</div>



 <div class="submit-msg alert modal fade" id="universal_msg_modal11" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header py-2 flex-row align-items-center justify-content-between">
        <button class="close " type="button" data-dismiss="modal" aria-label="Close">
          <div class="close-btn mt-0 ">
            <span aria-hidden="true">×</span>
          </div>
        </button>
      </div>
      <div class="modal-body">
        <div class="row form-row">
          <div class="col-lg-12 text-center">
              <p class="m-0" id="universal_msg11"></p>
          </div>          
        </div>
      </div>
      <div class="modal-footer border-top-0">
        <button class="d-sm-inline-block btn btn-sm btn-primary sbt-btn shadow-sm " type="button"  data-dismiss="modal"> Ok </button>
      </div>
    </div>
  </div>
</div>

<div class="submit-msg alert modal fade" id="universal_msg_modal1111" tabindex="-1" role="dialog"
  aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header py-1 flex-row align-items-center justify-content-between">
        <button class="close " type="button" data-dismiss="modal" aria-label="Close">
          <div class="close-btn">
            <span aria-hidden="true">×</span>
          </div>
        </button>
      </div>
      <div class="modal-body">
        <div class="row form-row">
          <div class="col-lg-12 text-center">
            <p class="m-0" >Something Went Wrong</p>
          </div>
        </div>
      </div>
      <div class="modal-footer border-top-0">
        <button class="d-sm-inline-block btn btn-sm btn-primary sbt-btn shadow-sm " type="button"
          data-dismiss="modal"> Ok </button>
      </div>
    </div>
  </div>
</div>



 <div class="adjust-clock task add-dce manager-alert modal" id="logout-conformation-popup" tabindex="-1" role="dialog"
  aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header py-2 flex-row align-items-center justify-content-between">
        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
          <div class="close-btn mt-0">
            <span aria-hidden="true">×</span>
          </div>
        </button>
      </div>
      <div class="modal-body p-3 p-md-4 p-lg-4">
        <div class="row form-row">
          <div class="col-lg-12 text-center">
            <p class="m-0" id="universal_ssmsg">Are you sure you want to logout?</p>
          </div>
        </div>
      </div>
      <div class="modal-footer border-top-0">
        <a class="d-sm-inline-block btn btn-sm btn-primary yes-btn sbt-btn shadow-sm mr-2" href="{% url 'logout' %}"> Yes </a>
        <button class="d-sm-inline-block btn btn-sm btn-primary yes-btn sbt-btn brown-clr shadow-sm" type="button"
          data-dismiss="modal"> No </button>
      </div>
    </div>
  </div>
</div>


<!-- Bootstrap core JavaScript-->
<script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
<script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<!-- Core plugin JavaScript-->
<script src="{% static 'vendor/jquery-easing/jquery.easing.min.js' %}"></script>
<!-- Custom scripts for all pages-->
<script src="{% static 'js/sb-admin-2.js' %}"></script>
<script type="text/javascript">

    function accept_number(evt){
          evt = (evt) ? evt : window.event;
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                return false;
            }
            return true;
        }


    function department_validation(){
      dept = $("#department option:selected").text()
      if(dept == "Please select department"){
        $("#department_error").html("Please select department")
        $("#department_error").show()
        return false
      }
      else{
        $("#department_error").hide()
        return true
      }
    }

    function full_name_validation(){
      var full_name_regex = /^[a-zA-Z ]+$/;
      full_name = $('#emergency_contact_person').val()
      full_name = $.trim(full_name)
      if(full_name == '' || full_name == null) {
          $("#emergency_contact_person_error").show()
          $("#emergency_contact_person_error").html("This field is required");               
          return false;
      }
      else if(full_name_regex.test(full_name) == false){
          $("#emergency_contact_person_error").show()
          $("#emergency_contact_person_error").html("Name must not contain numbers or any special characters");
          return false;                
      }

      else if (full_name.length < 3){
          $("#emergency_contact_person_error").show()
          $("#emergency_contact_person_error").html("Name must contain more than 3 characters");
          return false;
      }
      else if(full_name.length > 50){
          $("#emergency_contact_person_error").show()
          $("#emergency_contact_person_error").html("Name must contain less than 50 characters");
          return false; 
      }
      else{
          $("#emergency_contact_person_error").hide()
          return true;
      }
    }


    function phone_number_validation(){
        phone_number = $("#contact_number").val()

        if (phone_number == ""){
            $("#contact_number_label").show()
            $("#contact_number_label").html("This field is required")
            return false
        }
        else if (phone_number.length < 4 || phone_number.length >20){
            $("#contact_number_label").show()
            $("#contact_number_label").html("A phone number must contain 4-20 digits")
            return false;
        }
        else{
            $("#contact_number_label").hide()
            return true;               
        }
    }

    function email_validation(){
        email = $('#email').val()
        email = $.trim(email)
        var regex = /^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;

        if(email.length == '' || email.length == null) {
            $("#error_email").show()
            $("#error_email").html("This field is required");
            return false;
        }            
        else if(regex.test(email)==false){
            $("#error_email").show()
            $("#error_email").html("Please enter a valid email address")
            return false;
        }
        else{
            $("#error_email").hide()
            return true;
        }
    }

    $("#edit_profile_btn").click(function(){
        $('#email').prop('readonly', false);
        $('#emergency_contact_person').prop('readonly', false);
        $('#contact_number').prop('readonly', false);
        $('#department').prop('disabled', false);
        
        var first_name = $('#emergency_contact_person').val();
        first_name = first_name.trim()        
        $('#emergency_contact_person').focus().val('').val(first_name);
        $("#update_btn").prop('disabled', false);

    })


    $("#update_btn").click(function(){
        // phone_number_validation()
        email_validation()
        // department_validation()
        full_name_validation()
        if ( email_validation()  && full_name_validation()){
        $.ajax({
            type: 'POST',
            url: "{% url 'manager_profile_post' %}",
            data: {
                "manager_id" : "{{manager_id}}",
                "emergency_contact_person" : $("#emergency_contact_person").val(),
                "email" : $("#email").val(),
                // "department" : $("#department option:selected").text(),
                // "department_id" : $("#department option:selected").val(),
            },
            success: function(response){
              if(response == 1){
                $("#universal_msg").text("Saved changes successfully")
                $("#universal_msg_modal").modal("show")
              }
              else if(response == 5){
                $("#universal_msg11").text("Email already exist")
                $("#universal_msg_modal11").modal("show")
              }
              else{
                $("#universal_msg_modal1111").modal("show")
              }
            }
        });
        }
     })

    $(".close-bntn").click(function(){
        location.href = "{% url 'admin_dashboard' %}";
    })


</script>
</body>

</html>